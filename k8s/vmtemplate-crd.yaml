apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: vmtemplates.custom.greendeploy.io
spec:
  group: custom.greendeploy.io
  versions:
    - name: v1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                # --- Fields that the USER will provide (their generic requirements) ---
                duration_hours:
                  type: integer
                  description: "The total runtime needed for the VM workload in hours."
                cpu:
                  type: string
                  description: "The amount of CPU resources required (e.g., '2', '500m')."
                ram:
                  type: string
                  description: "The amount of RAM resources required (e.g., '4Gi', '1024Mi')."
                
                # --- Optional, advanced user constraints ---
                gpu:
                  type: object
                  description: "(Optional) GPU requirements for the workload."
                  properties:
                    count: { type: integer, minimum: 1 }
                    type: { type: string }
                  required: ["count", "type"]
                latency:
                  type: object
                  description: "(Optional) Network latency constraints."
                  properties:
                    max_ms:
                      type: integer
                      description: "The maximum allowed latency in milliseconds."
                    from_region:
                      type: string
                      description: "The user's origin region for latency calculation."
                  required: ["from_region", "max_ms"]
                schedulingLocation:
                  type: string
                  description: "The optimal cloud region chosen by the scheduler."
                schedulingTime:
                  type: string
                  format: date-time
                  description: "The optimal UTC start time chosen by the scheduler."
                  
              # These are the only fields that are truly mandatory for any request.
              required: ["duration_hours", "cpu", "ram"]

  scope: Namespaced
  names:
    plural: vmtemplates
    singular: vmtemplate
    kind: VmTemplate
    shortNames:
    - vmt